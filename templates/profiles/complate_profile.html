{% extends 'base.html' %}
{% load i18n %}

{% block title %}{% trans "Complate Profile" %} | {% endblock%}

{% block layout %}
<div class="min-h-screen bg-slate-50 flex items-center justify-center p-4 font-sans">
    <div class="max-w-md w-full bg-white rounded-[2rem] shadow-sm border border-slate-100 overflow-hidden"
         x-data="{
                    isSaving : false,
                    imageUrl: '{% if user.profile.avatar %}{{ user.profile.avatar.url }}{% else %}null{% endif %}',
                    fileChosen(event) {
                        const file = event.target.files[0];
                        if (!file) return;
                        const reader = new FileReader();
                        reader.readAsDataURL(file);
                        reader.onload = e => this.imageUrl = e.target.result;
                    }
                }">

        <div class="p-8 text-center bg-slate-50/50 border-b border-slate-100">
            <h1 class="text-2xl font-black text-slate-800">{% trans "Complete Profile" %}</h1>
            <p class="text-sm text-slate-500 mt-1">{% trans "This step is optional, you can skip it for now." %}</p>
        </div>

        <form method="post" enctype="multipart/form-data" class="p-8 space-y-6 text-left" dir="ltr" @submit="isSaving = true">
            {% csrf_token %}

            <div class="flex flex-col items-center mb-10">
                <div class="relative w-32 h-32">
                    <label for="avatar_input" class="cursor-pointer group block">
                        <div class="w-32 h-32 rounded-full border-4 border-white shadow-xl overflow-hidden bg-slate-100 flex items-center justify-center transition-transform group-hover:scale-105">
                            <template x-if="imageUrl && imageUrl !== 'null'">
                                <img :src="imageUrl" class="w-full h-full object-cover" alt="avatar-image"/>
                            </template>
                            <template x-if="!imageUrl || imageUrl === 'null'">
                                <div class="flex items-center justify-center w-full h-full bg-slate-200">
                                    <svg class="w-14 h-14 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                </div>
                            </template>
                        </div>
                        <div class="absolute bottom-1 right-1 bg-primary text-white p-2.5 rounded-full shadow-lg border-2 border-white">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                    </label>
                    <input type="file" name="avatar" id="avatar_input" class="hidden" accept="image/*" @change="fileChosen">
                </div>
                <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest mt-4">{% trans "Profile Picture" %}</span>
            </div>

            <div class="space-y-1">
                <label class="block text-sm font-bold text-slate-700 px-2">{% trans "About Me" %}</label>
                <textarea name="bio" rows="4" class="input-main h-32 resize-none" placeholder="{% translate 'Tell us about yourself...' %}">{{ form.bio.value|default_if_none:'' }}</textarea>
                {% if form.bio.errors %}<p class="text-rose-500 text-xs px-2">{{ form.bio.errors.0 }}</p>{% endif %}
            </div>

            <div class="space-y-1">
                <label class="block text-sm font-bold text-slate-700 px-2">{% trans "Phone Number" %}</label>
                <input type="text" name="phone_number" class="input-main" placeholder="+989*********" value="{{ form.phone_number.value|default_if_none:'' }}">
                {% if form.phone_number.errors %}<p class="text-rose-500 text-xs px-2">{{ form.phone_number.errors.0 }}</p>{% endif %}
            </div>

            <div class="space-y-1">
                <label class="block text-sm font-bold text-slate-700 px-2">{% trans "Country" %}</label>
                <div class="relative">
                    <select name="country" class="input-main appearance-none cursor-pointer">
                        <option value="">{% trans "Select country" %}</option>
                        {% for country in countries %}
                        <option value="{{ country.id }}" {% if form.country.value == country.id %}selected{% endif %}>{{ country.name }}</option>
                        {% endfor %}
                    </select>
                    <div class="pointer-events-none absolute inset-y-0 right-5 flex items-center text-slate-400">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M19 9l-7 7-7-7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    </div>
                </div>
                {% if form.country.errors %}<p class="text-rose-500 text-xs px-2">{{ form.country.errors.0 }}</p>{% endif %}
            </div>

            <div class="grid grid-cols-2 gap-4 pt-4">
                <button type="submit" x-show="!isSaving" class="btn-primary">
                    <span >{% trans "Save Profile" %}</span>
                </button>
                <button type="submit" x-show="isSaving" class="btn-disable" disabled>
                    <span x-show="isSaving">{% trans "Saving ..." %}</span>
                </button>
                <a href="{% url 'home' %}" class="btn-secondary">
                    {% trans "Skip" %}
                </a>
            </div>
        </form>
    </div>
</div>
{% endblock %}